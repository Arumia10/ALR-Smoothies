<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <!-- Add this script once in your <head> -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
  <title>VitaminBoost ALR ‚Äì Fresh Smoothies</title>
  <style>
    .hidden { display: none; }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial; max-width:600px; margin:0 auto; background:#fff; color:#333; line-height:1.4; }
    :root { --accent:#0071e3; }
   
       header.header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
      padding: 1rem;
      border-bottom: 1px solid #eaeaea;
    }

      .logo {
        font-size: 1.6rem;
        font-weight: 600;
        color: var(--accent);
        line-height: 0.6; /* reduced from 1.2 */
      }

      .logo-main,
      .logo-sub {
        display: block;
        margin: 0;
        padding: 0;
      }
    nav a { margin-left:1rem; text-decoration:none; color:#333; font-size:.9rem; }
    nav a:hover { color:#777; }
    .nav-links {
  display: flex;
  flex-wrap: wrap;     /* Allows wrapping of the entire nav group */
  gap: 1.5rem;
  justify-content: flex-end;
  flex: 1;              /* So it pushes to fill remaining space */
}

.nav-links a {
  text-decoration: none;
  color: #333;
  font-size: 0.95rem;
  white-space: nowrap;
}

.nav-links a:hover {
  color: #777;
}
    .hero {
  background: linear-gradient(135deg, #ffecd2, #fcb69f);
  text-align: center;
  padding: 4rem 2rem;
  border-radius: 12px;
  margin: 2rem 1rem;
}
.hero h1 {
  font-size: 2.4rem;
  font-weight: 700;
  color: #222;
}
.hero p {
  font-size: 1.1rem;
  color: #555;
  margin-bottom: 1.5rem;
}
    .btn { background:var(--accent); color:#fff; padding:.7rem 1.4rem; border:none; border-radius:6px; font-size:1rem; cursor:pointer; text-decoration:none; transition:background .3s; }
    .btn:hover { background:#005bb8; }
    .btn-secondary { background:#ccc; color:#333; }
    .btn-secondary:hover { background:#bbb; }
    section { padding:2rem 1rem; }
    .vacuum { text-align:center; background:#f9f9f9; }
    .vacuum h2 { font-size:1.6rem; margin-bottom:.5rem; }
    .vacuum p { max-width:500px; margin:0 auto 1.5rem; color:#555; }
    .vacuum img { width:100%; max-width:500px; border-radius:8px; margin:0 auto 1rem; display:block; }
    .vacuum .sub { color:#555; font-size:.9rem; margin-bottom:1.5rem; }
    .menu h2 { text-align:center; font-size:1.5rem; margin-bottom:1.5rem; }
    .cards { display:grid; grid-template-columns:repeat(2, 1fr); gap:1.5rem; }
    @media(min-width:992px){ .cards { grid-template-columns:repeat(3,1fr); } }
    .card {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 100%; /* Ensure equal height for cards */
    }
    .card img { width:100%; display:block; }
    .card-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  justify-content: space-between;
  padding: 1rem;
  text-align: center;
}
    .card-content h3 { font-size:1.1rem; margin-bottom:.5rem; }
    .card-content p { color:#555; font-size:.9rem; margin-bottom:.3rem; }
    .card-content .sub { color:#777; font-size:.85rem; margin-bottom:.5rem; }
    .price { font-weight:bold; margin-bottom:1rem; }

.cart-panel {
  background: #fff;
  padding: 1.5rem;
  margin: 2rem 1rem;
  border-radius: 10px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  text-align: center;
}
.cart-items {
  max-height: 200px;
  overflow-y: auto;
  margin-bottom: 1rem;
  text-align: left;
}
.cart-item {
  display: flex;
  justify-content: space-between;
  margin-bottom: 0.5rem;
}
.cart-total {
  font-weight: 600;
  font-size: 1.1rem;
  margin-bottom: 1rem;
}
    #order-btn { width:100%; }
    .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
    .modal-content { background:#fff; padding:1.5rem; border-radius:8px; text-align:center; width:90%; max-width:400px; position:relative; }
    .close { position:absolute; top:1rem; right:1rem; cursor:pointer; font-size:1.2rem; }
    .modal-content input, .modal-content select { width:100%; padding:.5rem; margin:.5rem 0; border:1px solid #ddd; border-radius:6px; }
    #qr-code { width:200px; height:200px; margin:1rem auto; }


.contact-section {
  text-align: center;
  padding: 2rem 1rem;
  background: #f7f7f7;
  border-radius: 8px;
  margin: 2rem 1rem;
}

.contact-section h2 {
  font-size: 1.8rem;
  margin-bottom: 1rem;
  color: #0071e3;
}

.contact-section p {
  font-size: 1rem;
  color: #444;
}
.footer {
  text-align: center;
  font-size: 0.85rem;
  color: #888;
  border-top: 1px solid #eaeaea;
  padding: 1rem;
  margin-top: 3rem;
}
    
    .home-gallery {
  padding: 2rem 1rem;
  background: #fefefe;
}

.home-gallery .gallery {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 1rem;
  margin-top: 1rem;
}

.home-gallery .gallery img {
  width: 100%;
  border-radius: 10px;
  object-fit: cover;
  height: 140px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  transition: transform 0.3s;
}

.home-gallery .gallery img:hover {
  transform: scale(1.03);
}

  </style>
  <!-- EmailJS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>emailjs.init('QYlRz8dURmihM96yW');</script>
</head>
<body>
<!-- Loader -->
  <div id="loader" style="
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    z-index: 9999;
    font-family: 'Inter', sans-serif;
    font-size: 1.2rem;
    color: #0071e3;
  ">
    Loading VitaminBoost...
  </div>
  
<!-- All actual site content inside here -->
 <div id="main-content" style="display: block;">
    <div style="max-width: 600px; margin: 0 auto; padding: 1rem;">

      <header class = "header">
        <div class="logo">
          <span class="logo-main">VitaminBoost</span><br>
          <span class="logo-sub">ALR</span>
        </div>
        <nav class="nav-links">
          <a href="#home">Home</a>
          <a href="#vacuum">Vacuum Blending</a>
          <a href="#menu">Menu</a>
          <a href="#contact">Contact</a>
        </nav>
      </header>

      <section class="hero" style="
        text-align: center;
        padding: 1.5rem 1rem;
        background: linear-gradient(135deg, #ffecd2, #fcb69f);
        border-radius: 12px;
        margin: 2rem 0;
      ">
        <h1 style="font-size: 2rem; font-weight: bold;">Experience the Smoothest<br>Smoothies Ever</h1>
        <p style="color: #555; margin: 1rem 0;">Vacuum-blended. Vitamin-rich. Bursting with real fruit.</p>

        <img src="https://raw.githubusercontent.com/Arumia10/ALR-Smoothies/refs/heads/main/Pictures/Fruits%20and%20smoothie.jpg"
             alt="Smoothie with fruits"
             style="width: 100%; max-width: 450px; height: auto; margin: 0 auto; display: block; border-radius: 8px;">

        <a href="#menu" class="btn" style="margin-top: 1.5rem; display: inline-block;">Order Now</a>
      </section>

      <section id="vacuum" class="vacuum" style="text-align: center ; padding: 3rem 0; border-radius: 12px; margin: 2rem 0;">
        <h2>Our Vacuum Blending Process</h2>
        <img src="https://github.com/Arumia10/ALR-Smoothies/blob/main/Pictures/Regular%20vs%20Vacuum%20Blended.png?raw=true" alt="Blender Comparison" style="width: 100%; max-width: 500px; border-radius: 12px;">
        <p style="margin: 1rem auto; max-width: 500px;">At VitaminBoost ALR, we use a <strong> Vacuum Blender</strong> to remove air before blending. Benefits:</p>
        <ul style="list-style:none; padding: 0; text-align: left; max-width: 500px; margin: 0 auto;">
          <li>üçè Reduces oxidation & browning</li>
          <li>üåà Preserves vibrant color & flavor</li>
          <li>üí™ Locks in vitamins & antioxidants</li>
          <li>‚ú® Smoother, creamier texture</li>
          <li>‚è±Ô∏è Fresh for at least 48 hours</li>
        </ul>
      </section>

      <section id="menu" class="menu">
        <h2 style="text-align: center;">Our Flavors</h2>
        <div class="cards">
          <div class="card">
            <img src="https://raw.githubusercontent.com/Arumia10/ALR-Smoothies/refs/heads/main/Pictures/Red%20Smoothie.jpg" alt="Red Smoothie">
            <div class="card-content">
              <h3>Red Smoothie</h3>
              <p>Strawberry, Raspberry, Dates</p>
              <p class="sub">330 ml ¬∑ Vacuum Blended</p>
              <div class="price">‚Ç¨3,50</div>
              <button class="btn btn-add" style="width: 120px; text-align: center; white-space: nowrap;">Add to Cart</button>
            </div>
          </div>
          <div class="card">
            <img src="https://raw.githubusercontent.com/Arumia10/ALR-Smoothies/refs/heads/main/Pictures/Yellow%20Smoothie.jpg" alt="Tropical Twist">
            <div class="card-content">
              <h3>Tropical Twist</h3>
              <p>Orange, Mango, Pineapple</p>
              <p class="sub">330 ml ¬∑ Vacuum Blended</p>
              <div class="price">‚Ç¨3,50</div>
              <button class="btn btn-add" style="width: 120px; text-align: center; white-space: nowrap;">Add to Cart</button>
            </div>
          </div>
          <div class="card">
            <img src="https://raw.githubusercontent.com/Arumia10/ALR-Smoothies/refs/heads/main/Pictures/Purple%20Smoothie.jpg" alt="Berry Blast">
            <div class="card-content">
              <h3>Berry Blast</h3>
              <p>Strawberry, Raspberry, Blueberry, Blackberry, Dates</p>
              <p class="sub">330 ml ¬∑ Vacuum Blended</p>
              <div class="price">‚Ç¨3,50</div>
              <button class="btn btn-add" style="width: 120px; text-align: center; white-space: nowrap;">Add to Cart</button>
            </div>
          </div>
        </div>
      </section>

      <div class="cart-panel">
        <h2>Your Cart</h2>
        <div id="cart-items"></div>
        <div id="cart-total" class="cart-total">Total: ‚Ç¨0,00</div>
        <button id="order-btn" class="btn">Order</button>
      </div>

      <section id="promise" style="padding: 2rem 1rem; background-color: #f4f9ff; border-radius: 12px; margin: 2rem 0;">
        <h2 style="text-align: center; font-size: 1.8rem; color: #0071e3; margin-bottom: 1.5rem;">What Makes Us Different</h2>
        <ul style="list-style: none; padding: 0; color: #333; font-size: 1rem; max-width: 500px; margin: 0 auto;">
          <li style="margin-bottom: 1rem;">üåø 100% real fruit ‚Äî no added sugar, no juice.</li>
          <li style="margin-bottom: 1rem;">üåÄ Vacuum blending locks in nutrients and flavor.</li>
          <li style="margin-bottom: 1rem;">‚ôªÔ∏è Eco-friendly packaging, because we care.</li>
          <li style="margin-bottom: 1rem;">üìç Convenient Pickup & Delivery</li>
        </ul>
      </section>

      <section style="text-align: center; padding: 2rem 1rem; background: #fff0db; border-top: 2px solid #fcb69f; border-radius: 12px;">
        <h2 style="font-size: 2rem; margin-bottom: 1rem; color: #f25c05;">Make ALR Healthy Again</h2>
        <img src="https://raw.githubusercontent.com/Arumia10/ALR-Smoothies/refs/heads/main/Pictures/ALR%20Smoothie.jpg" alt="ALR Bird with Smoothie" style="max-width: 100%; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
      </section>

    </div>
  </div>

  <!-- Details Modal -->
<div class="modal" id="details-modal">
  <div class="modal-content">
    <span class="close" id="close-details">√ó</span>
    <h2>Your Details</h2>
    <input type="text" id="fname" placeholder="First Name" required>
    <input type="text" id="lname" placeholder="Surname" required>
    <input type="email" id="email" placeholder="Email Address" required>
    <select id="role" required>
      <option value="" disabled selected>Select role</option>
      <option value="Student">Student</option>
      <option value="Teacher">Teacher</option>
      <option value="Other">Other</option>
    </select>

 <div id="pickup-date-wrapper" class="hidden">
  <label for="pickup-date" id="pickup-date-label">Pickup Date</label>
  <input type="date" id="pickup-date" required>
</div>

    <div id="tuesday-options" class="hidden" style="margin-top:1rem; text-align:left;">
      <p><strong>Tuesday Delivery:</strong> 14:00‚Äì14:20</p>
      <input type="text" id="location-tue" placeholder="Delivery Location (e.g. A110)" required>
    </div>

    <div id="wednesday-options" class="hidden" style="margin-top:1rem; text-align:left;">
      <p><strong>Wednesday:</strong></p>
      <label id="radio-pickup"><input type="radio" name="wed-option" value="pickup"> Pickup @ <span id="pickup-location-label">Proffen Konferenz</span> (09:30‚Äì09:50)</label>
      <label id="radio-delivery"><input type="radio" name="wed-option" value="delivery"> Delivery (10:00‚Äì10:20)</label>
      <div id="location-wed" class="hidden" style="margin-top:.5rem;">
        <input type="text" id="location-wed-input" placeholder="Delivery Location (e.g. C104)" required>
      </div>
    </div>

    <div class="cart-total">Total: <span id="details-total">‚Ç¨0,00</span></div>
    <button id="to-payment" class="btn">Proceed to Payment</button>
  </div>
</div>

  <!-- QR Modal -->
  <!-- QR Modal -->
<div class="modal" id="qr-modal">
  <div class="modal-content">
    <span class="close" id="close-qr">√ó</span>
    <h2>Scan &amp; Pay</h2>
    <p>Please scan the Payconiq QR code below to complete your payment.</p>

    <img id="qr-code" src="https://github.com/Arumia10/ALR-Smoothies/blob/main/Pictures/4TPCM%20Mini-Entreprise%20Payconiq.png?raw=true" alt="QR Code" style="width: 200px; height: auto; margin: 1rem auto; display: block;">

    <!-- ‚úÖ Turnstile goes here inside modal content -->
    <div class="cf-turnstile" data-sitekey="0x4AAAAAABd3MtYix_xppNef" data-theme="light" style="margin: 1rem auto;"></div>

    <div style="display:flex; justify-content:space-between; margin-top:1rem;">
      <button id="back-btn" class="btn btn-secondary">Back</button>
      <button id="confirm-pay" class="btn">Confirm Payment</button>
    </div>
  </div>
</div>
   

<!-- CONTACT SECTION -->
<section id="contact" class="contact-section">
  <h2>Contact Us</h2>
  <p>Reach out via Microsoft Teams:</p>
  <p><strong>No√©mie Baum</strong> | <strong>Clara Andrade Pereira</strong></p>
</section>

<!-- FOOTER -->
<footer class="footer">
  <p>¬© 2025 VitaminBoost ALR. All rights reserved.</p>
</footer>
 
</div>
  
 <!-- Loader script -->
  <script>
      window.addEventListener('load', function () {
        document.getElementById('loader').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';

        // Ensure scroll to top after rendering
        setTimeout(() => window.scrollTo(0, 0), 10);
      });
  </script>
</body>

  <script>
const pickupInput = document.getElementById('pickup-date');
const roleSelect = document.getElementById('role');

function hideAllDayOptions() {
  document.getElementById('tuesday-options').classList.add('hidden');
  document.getElementById('wednesday-options').classList.add('hidden');
}

function isWednesday(dateStr) {
  return new Date(dateStr).getUTCDay() === 3;
}

function isTuesday(dateStr) {
  return new Date(dateStr).getUTCDay() === 2;
}

// Set minimum date to next Tuesday
const today = new Date();
const offset = (2 - today.getDay() + 7) % 7;
const nextTue = new Date(today);
nextTue.setDate(today.getDate() + offset);
const yyyy = nextTue.getFullYear();
const mm = String(nextTue.getMonth() + 1).padStart(2, '0');
const dd = String(nextTue.getDate()).padStart(2, '0');
pickupInput.min = `${yyyy}-${mm}-${dd}`;
pickupInput.value = pickupInput.min;
hideAllDayOptions();

function updatePickupOptions() {
  const role = roleSelect.value;
  const label = document.getElementById('pickup-date-label');
  const wrapper = document.getElementById('pickup-date-wrapper');
  const day = new Date(pickupInput.value).getUTCDay(); // 2=Tue, 3=Wed

  if (!role) {
    wrapper.classList.add('hidden');
    return;
  } else {
    wrapper.classList.remove('hidden');
  }

  // update label text
  if (role === 'Student') {
    label.textContent = 'Pickup Date (Wednesdays only)';
  } else {
    label.textContent = 'Pickup Date (Tuesdays & Wednesdays)';
  }

  hideAllDayOptions();

if (role === "Student") {
  // Update label
  label.textContent = 'Pickup Date (Wednesdays only)';

  // Hide delivery option
  document.getElementById('radio-delivery').classList.add('hidden');

  if (day !== 3) {
    pickupInput.setCustomValidity("As a student, you may only select Wednesdays.");
    pickupInput.reportValidity();
  } else {
    pickupInput.setCustomValidity('');
    document.getElementById('wednesday-options').classList.remove('hidden');
    
    // Force student to pickup only
    document.querySelector('input[name="wed-option"][value="pickup"]').checked = true;
    document.getElementById('location-wed').classList.add('hidden');
    document.getElementById('location-wed-input').value = 'Virum Festsall';
    document.getElementById('pickup-location-label').textContent = 'Virum Festsall';
  }
}
  
  else {
  label.textContent = 'Pickup Date (Tuesdays & Wednesdays)';

  // Show delivery option again
  document.getElementById('radio-delivery').classList.remove('hidden');

  // Always reset pickup label to default
  document.getElementById('pickup-location-label').textContent = 'Proffen Konferenz';

  if (day === 2) {
    document.getElementById('tuesday-options').classList.remove('hidden');
    pickupInput.setCustomValidity('');
  } else if (day === 3) {
    document.getElementById('wednesday-options').classList.remove('hidden');
    pickupInput.setCustomValidity('');

    // Clear "Virum Festsall" from delivery field if left by student
    const deliveryInput = document.getElementById('location-wed-input');
    if (deliveryInput.value === 'Virum Festsall') {
      deliveryInput.value = '';
    }
  } else {
    pickupInput.setCustomValidity('Please choose a Tuesday or Wednesday');
    pickupInput.reportValidity();
  }
}
}
// Listen to changes
pickupInput.addEventListener('input', updatePickupOptions);
roleSelect.addEventListener('change', updatePickupOptions);
    
    

// ----------------------------
// 2) Wednesday radio logic
// ----------------------------
document.querySelectorAll('input[name="wed-option"]').forEach(radio => {
  radio.addEventListener('change', () => {
    const locWed = document.getElementById('location-wed');
    locWed.classList.toggle('hidden', radio.value !== 'delivery');
  });
});

    
// ----------------------------
// 3) Cart logic
// ----------------------------
const cart = [];

document.querySelectorAll('.btn-add').forEach(btn => {
  const card = btn.closest('.card');
  const name = card.querySelector('h3').textContent;
  const price = parseFloat(
    card.querySelector('.price').textContent
      .replace('‚Ç¨', '')
      .replace(',', '.')
  );
  btn.addEventListener('click', () => {
    cart.push({ name, price });
    renderCart();
    btn.textContent = "‚úì Added";
    setTimeout(() => btn.textContent = "Add to Cart", 2200);
  });
});

    
// 3.1) Cart Rendering   
function renderCart() {
  const container = document.getElementById('cart-items');
  const orderBtn = document.getElementById('order-btn');
  container.innerHTML = '';

  const grouped = {};
  cart.forEach((item) => {
    if (!grouped[item.name]) {
      grouped[item.name] = { qty: 0, price: item.price };
    }
    grouped[item.name].qty++;
  });

  let total = 0;
  Object.entries(grouped).forEach(([name, info]) => {
    const lineTotal = info.price * info.qty;
    total += lineTotal;

    const div = document.createElement('div');
    div.className = 'cart-item';
    div.innerHTML = `
      <div style="display:flex; align-items:center; gap:0.5rem;">
        <button class="btn-qty" data-name="${name}" data-action="decrease">‚àí</button>
        <span>${info.qty}√ó ${name}</span>
        <button class="btn-qty" data-name="${name}" data-action="increase">+</button>
      </div>
      <div>
        <span>‚Ç¨${lineTotal.toFixed(2).replace('.', ',')}</span>
        <button class="btn-remove" data-name="${name}">üóëÔ∏è</button>
      </div>
    `;
    container.appendChild(div);
  });

  document.getElementById('cart-total').textContent =
    `Total: ‚Ç¨${total.toFixed(2).replace('.', ',')}`;

  // Enable or disable the order button
  orderBtn.disabled = cart.length === 0;

  attachCartHandlers();
}
    
// 3.2) Cart Handlers
    function attachCartHandlers() {
  // Adjust quantity
  document.querySelectorAll('.btn-qty').forEach(btn => {
    btn.addEventListener('click', () => {
      const name = btn.getAttribute('data-name');
      const action = btn.getAttribute('data-action');

      const index = cart.findIndex(item => item.name === name);
      if (index !== -1) {
        if (action === 'decrease') {
          // Remove one instance
          cart.splice(index, 1);
        } else if (action === 'increase') {
          cart.push({ name, price: cart[index].price });
        }
        renderCart();
      }
    });
  });

  // Remove all of a smoothie
  document.querySelectorAll('.btn-remove').forEach(btn => {
    btn.addEventListener('click', () => {
      const name = btn.getAttribute('data-name');
      for (let i = cart.length - 1; i >= 0; i--) {
        if (cart[i].name === name) {
          cart.splice(i, 1);
        }
      }
      renderCart();
    });
  });
}

  // 4) Order ‚Üí Details
document.getElementById('order-btn').addEventListener('click', () => {
  if (cart.length === 0) {
    // Show feedback to user
    const btn = document.getElementById('order-btn');
    const originalText = btn.textContent;
    btn.textContent = 'üõí Add a smoothie first!';
    btn.disabled = true;

    setTimeout(() => {
      btn.textContent = originalText;
      btn.disabled = false;
    }, 2000);
    return;
  }

  renderCart();
  document.getElementById('details-total').textContent =
    document.getElementById('cart-total').textContent.split(' ')[1];
  document.getElementById('details-modal').style.display = 'flex';
});
  document.getElementById('close-details').addEventListener('click', () => {
    document.getElementById('details-modal').style.display = 'none';
  });

  // 5) Details ‚Üí QR
  document.getElementById('to-payment').addEventListener('click', () => {
    const fn = document.getElementById('fname').value.trim();
    const ln = document.getElementById('lname').value.trim();
    const em = document.getElementById('email').value.trim();
    const rl = document.getElementById('role').value;
    const pd = document.getElementById('pickup-date').value;
    if (!fn || !ln || !em || !rl || !pd) {
      return alert('Please fill all fields and select a pickup date');
    }
    document.getElementById('details-modal').style.display = 'none';
    document.getElementById('qr-modal').style.display = 'flex';
  });
  document.getElementById('close-qr').addEventListener('click', () => {
    document.getElementById('qr-modal').style.display = 'none';
  });
  document.getElementById('back-btn').addEventListener('click', () => {
    document.getElementById('qr-modal').style.display = 'none';
    document.getElementById('details-modal').style.display = 'flex';
  });

  // 6) Confirm & EmailJS
  document.getElementById('confirm-pay').addEventListener('click', () => {
    // Build customer details
    const fn = document.getElementById('fname').value.trim();
    const ln = document.getElementById('lname').value.trim();
    const customerName = `${fn} ${ln}`;
    const customerEmail = document.getElementById('email').value.trim();
    const customerRole = document.getElementById('role').value;
    // Reformat pickup date
    const [Y, M, D] = document.getElementById('pickup-date').value.split('-');
    const pickupDate = `${D}/${M}/${Y}`;
    const token = turnstile.getResponse();

    if (!token) {
      alert("Please complete the human check (Turnstile).");
      return;
    }

    // Build order details string
    const grouped = {};
    cart.forEach(item => {
      if (!grouped[item.name]) grouped[item.name] = { qty: 0, price: item.price };
      grouped[item.name].qty++;
    });
    let orderDetails = '';
    Object.entries(grouped).forEach(([name, info]) => {
      orderDetails += `${info.qty}√ó ${name}: ‚Ç¨${(info.price * info.qty)
        .toFixed(2)
        .replace('.', ',')}\n`;
    });

    // Total formatting
    const rawTotal = document.getElementById('cart-total').textContent
      .replace('Total: ‚Ç¨', '')
      .replace(',', '.');
    const formattedTotal = `${rawTotal}‚Ç¨`;

    // determine which location to include
    let deliveryLocation = '';
    const wd = new Date(document.getElementById('pickup-date').value).getUTCDay();

    if (wd === 2) {
      // Tuesday delivery at fixed time
      const loc = document.getElementById('location-tue').value.trim();
      deliveryLocation = `14:00‚Äì14:20 @ ${loc}`;
    } else if (wd === 3) {
  const role = document.getElementById('role').value;

  if (role === 'Student') {
    deliveryLocation = `09:30‚Äì09:50 @ Virum Festsall`;
  } else {
    const choice = document.querySelector('input[name="wed-option"]:checked')?.value;
    if (choice === 'delivery') {
      const loc = document.getElementById('location-wed-input').value.trim();
      deliveryLocation = `10:00‚Äì10:20 @ ${loc}`;
    } else {
      deliveryLocation = `09:30‚Äì09:50 @ Proffen Konferenz`;
    }
  }
}
    // 6a) Send admin email
    emailjs.send('service_mivruy9', 'template_1728je9', {
      Name: customerName,
      email: customerEmail,
      order_details: orderDetails,
      total_amount: formattedTotal,
      pickup_date: pickupDate,
      user_role: customerRole,
      delivery_location: deliveryLocation
    })
    .then(r => console.log('Admin email sent', r.status, r.text))
    .catch(e => console.error('Admin email error', e));

    // 6b) Send customer email
    emailjs.send('service_mivruy9', 'template_u8nwalz', {
      Name: customerName,
      email: customerEmail,
      order_details: orderDetails,
      total_amount: formattedTotal,
      pickup_date: pickupDate,
      pickup_info: `Delivery window chosen`,
      delivery_location: deliveryLocation
    })
    .then(r => console.log('Customer email sent', r.status, r.text))
    .catch(e => console.error('Customer email error', e));

// 7) Save order to Cloudflare Worker before clearing cart
fetch("https://vitaminboostalr.9fhw2ps22t.workers.dev/", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    name: customerName,
    email: customerEmail,
    role: customerRole,
    pickup_date: pickupDate,
    delivery_location: deliveryLocation,
    order_details: orderDetails,
    total_amount: formattedTotal,
    cf_token: token
  })
})
.then(res => res.json())
.then(data => {
  if (data.success) {
    console.log("‚úÖ Order saved with ID:", data.order_id);
  } else {
    console.warn("‚ö†Ô∏è Failed to save order.");
  }

  // Proceed regardless of success for now
  cart.length = 0;
  renderCart();

  const mc = document.querySelector('#qr-modal .modal-content');
  mc.innerHTML = `
    <h2>Order Confirmed</h2>
    <p>Thank you! Your order has been confirmed.</p>
    <p><strong>Pickup Date:</strong> ${pickupDate}</p>
    <p>You can pick up or receive your smoothies as booked.</p>
    <button id="close-confirm" class="btn">Close</button>
  `;

  document.getElementById('close-confirm').addEventListener('click', () => {
    document.getElementById('qr-modal').style.display = 'none';
    location.reload();
  });
})
.catch(error => {
  console.error("‚ùå Error sending order to server:", error);
  alert("There was an error saving your order. Please try again.");
});
  });

  // 8) Dismiss modals on outside click
  window.addEventListener('click', e => {
    if (e.target.classList.contains('modal')) {
      e.target.style.display = 'none';
    }
  });
    
</script>

