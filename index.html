<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  script-src 'self' 'unsafe-inline' https://challenges.cloudflare.com https://cdn.jsdelivr.net;
  style-src 'self' 'unsafe-inline';
  img-src 'self' https://raw.githubusercontent.com https://github.com data:;
  frame-src https://challenges.cloudflare.com;
  connect-src 'self' https://vitaminboostalr.9fhw2ps22t.workers.dev https://api.emailjs.com;
">

  <title>VitaminBoost ALR â€“ Fresh Smoothies</title>
    
  <!-- External styles -->
  <link rel="stylesheet" href="style.css" />

  <!-- Add this script once in your <head> -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
  
  <!-- EmailJS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>emailjs.init('QYlRz8dURmihM96yW');</script>
</head>

  
<body>
<!-- Page content -->
<!-- Loader -->
  <div id="loader" style="
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    z-index: 9999;
    font-family: 'Inter', sans-serif;
    font-size: 1.2rem;
    color: #0071e3;
  ">
    Loading VitaminBoost...
  </div>
  
<!-- All actual site content inside here -->
 <div id="main-content" style="display: block;">
    <div style="max-width: 600px; margin: 0 auto; padding: 1rem;">

      <header class = "header">
        <div class="logo">
          <span class="logo-main">VitaminBoost</span><br>
          <span class="logo-sub">ALR</span>
        </div>
        <nav class="nav-links">
          <a href="#home">Home</a>
          <a href="#vacuum">Vacuum Blending</a>
          <a href="#menu">Menu</a>
          <a href="#contact">Contact</a>
        </nav>
      </header>

      <section class="hero" style="
        text-align: center;
        padding: 1.5rem 1rem;
        background: linear-gradient(135deg, #ffecd2, #fcb69f);
        border-radius: 12px;
        margin: 2rem 0;
      ">
        <h1 style="font-size: 2rem; font-weight: bold;">Experience the Smoothest<br>Smoothies Ever</h1>
        <p style="color: #555; margin: 1rem 0;">Vacuum-blended. Vitamin-rich. Bursting with real fruit.</p>

        <img src="https://raw.githubusercontent.com/Arumia10/ALR-Smoothies/refs/heads/main/Pictures/Fruits%20and%20smoothie.jpg"
             alt="Smoothie with fruits"
             style="width: 100%; max-width: 450px; height: auto; margin: 0 auto; display: block; border-radius: 8px;">

        <a href="#menu" class="btn" style="margin-top: 1.5rem; display: inline-block;">Order Now</a>
      </section>

      <section id="vacuum" class="vacuum" style="text-align: center ; padding: 3rem 0; border-radius: 12px; margin: 2rem 0;">
        <h2>Our Vacuum Blending Process</h2>
        <img src="https://raw.githubusercontent.com/Arumia10/ALR-Smoothies/refs/heads/main/Pictures/Regular%20vs%20Vacuum%20Blended.png" alt="Blender Comparison" style="width: 100%; max-width: 500px; border-radius: 12px;">
        <p style="margin: 1rem auto; max-width: 500px;">At VitaminBoost ALR, we use a <strong> Vacuum Blender</strong> to remove air before blending. Benefits:</p>
        <ul style="list-style:none; padding: 0; text-align: left; max-width: 500px; margin: 0 auto;">
          <li>ğŸ Reduces oxidation & browning</li>
          <li>ğŸŒˆ Preserves vibrant color & flavor</li>
          <li>ğŸ’ª Locks in vitamins & antioxidants</li>
          <li>âœ¨ Smoother, creamier texture</li>
          <li>â±ï¸ Fresh for at least 48 hours</li>
        </ul>
      </section>


      <!-- Flavors -->
      <section id="menu" class="menu">
        <h2 style="text-align: center;">Our Flavors</h2>
        <div class="cards">
          <div class="card">
            <img src="https://raw.githubusercontent.com/Arumia10/ALR-Smoothies/refs/heads/main/Pictures/Red%20Smoothie.jpg" alt="Red Smoothie">
            <div class="card-content">
              <h3>Red Smoothie</h3>
              <p>Strawberry, Raspberry, Dates</p>
              <p class="sub">330 ml Â· Vacuum Blended</p>
              <div class="price">â‚¬3,50</div>
              <button class="btn btn-add" style="width: 120px; text-align: center; white-space: nowrap;">Add to Cart</button>
            </div>
          </div>
          <div class="card">
            <img src="https://raw.githubusercontent.com/Arumia10/ALR-Smoothies/refs/heads/main/Pictures/Yellow%20Smoothie.jpg" alt="Tropical Twist">
            <div class="card-content">
              <h3>Tropical Twist</h3>
              <p>Orange, Mango, Pineapple</p>
              <p class="sub">330 ml Â· Vacuum Blended</p>
              <div class="price">â‚¬3,50</div>
              <button class="btn btn-add" style="width: 120px; text-align: center; white-space: nowrap;">Add to Cart</button>
            </div>
          </div>
          <div class="card">
            <img src="https://raw.githubusercontent.com/Arumia10/ALR-Smoothies/refs/heads/main/Pictures/Purple%20Smoothie.jpg" alt="Berry Blast">
            <div class="card-content">
              <h3>Berry Blast</h3>
              <p>Strawberry, Raspberry, Blueberry, Blackberry, Dates</p>
              <p class="sub">330 ml Â· Vacuum Blended</p>
              <div class="price">â‚¬3,50</div>
              <button class="btn btn-add" style="width: 120px; text-align: center; white-space: nowrap;">Add to Cart</button>
            </div>
          </div>
        </div>
      </section>

      <div class="cart-panel">
        <h2>Your Cart</h2>
        <div id="cart-items"></div>
        <div id="cart-total" class="cart-total">Total: â‚¬0,00</div>
        <button id="order-btn" class="btn">Order</button>
      </div>

      <!-- What Makes Us Different -->
      <section id="promise" style="padding: 2rem 1rem; background-color: #f4f9ff; border-radius: 12px; margin: 2rem 0;">
        <h2 style="text-align: center; font-size: 1.8rem; color: #0071e3; margin-bottom: 1.5rem;">What Makes Us Different</h2>
        <ul style="list-style: none; padding: 0; color: #333; font-size: 1rem; max-width: 500px; margin: 0 auto;">
          <li style="margin-bottom: 1rem;">ğŸŒ¿ 100% real fruit â€” no added sugar, no juice.</li>
          <li style="margin-bottom: 1rem;">ğŸŒ€ Vacuum blending locks in nutrients and flavor.</li>
          <li style="margin-bottom: 1rem;">â™»ï¸ Eco-friendly packaging, because we care.</li>
          <li style="margin-bottom: 1rem;">ğŸ“ Convenient Pickup & Delivery</li>
        </ul>
      </section>

      <section style="text-align: center; padding: 2rem 1rem; background: #fff0db; border-top: 2px solid #fcb69f; border-radius: 12px;">
        <h2 style="font-size: 2rem; margin-bottom: 1rem; color: #f25c05;">Make ALR Healthy Again</h2>
        <img src="https://raw.githubusercontent.com/Arumia10/ALR-Smoothies/refs/heads/main/Pictures/ALR%20Smoothie.jpg" alt="ALR Bird with Smoothie" style="max-width: 100%; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
      </section>

    </div>
  </div>

  <!-- Details Modal -->
<div class="modal" id="details-modal">
  <div class="modal-content">
    <span class="close" id="close-details">Ã—</span>
    <h2>Your Details</h2>
    <input type="text" id="fname" placeholder="First Name" required>
    <input type="text" id="lname" placeholder="Surname" required>
    <input type="email" id="email" placeholder="Email Address" required>
    <select id="role" required>
      <option value="" disabled selected>Select role</option>
      <option value="Student">Student</option>
      <option value="Teacher">Teacher</option>
      <option value="Other">Other</option>
    </select>


    <div id="pickup-date-wrapper" class="hidden">
  <label for="pickup-date" id="pickup-date-label">Pickup Date</label>
  <input type="date" id="pickup-date" required>
  <p style="font-size:0.85rem; color:#777; margin-top: 0.25rem;">
    âš ï¸ Orders after Tuesday 14:00 are for next week
  </p>
    </div>

    <div id="tuesday-options" class="hidden" style="margin-top:1rem; text-align:left;">
      <p><strong>Tuesday Delivery:</strong> 14:00â€“14:20</p>
      <input type="text" id="location-tue" placeholder="Delivery Location (e.g. A110)" required>
    </div>

    <div id="wednesday-options" class="hidden" style="margin-top:1rem; text-align:left;">
      <p><strong>Wednesday:</strong></p>
      <label id="radio-pickup"><input type="radio" name="wed-option" value="pickup"> Pickup @ <span id="pickup-location-label">Proffen Konferenz</span> (09:30â€“09:50)</label>
      <label id="radio-delivery"><input type="radio" name="wed-option" value="delivery"> Delivery (10:00â€“10:20)</label>
      <div id="location-wed" class="hidden" style="margin-top:.5rem;">
        <input type="text" id="location-wed-input" placeholder="Delivery Location (e.g. C104)" required>
      </div>
    </div>

    <div class="cart-total">Total: <span id="details-total">â‚¬0,00</span></div>
    <button id="to-payment" class="btn">Proceed to Payment</button>
  </div>
</div>


  
<!-- QR Modal -->
<div class="modal" id="qr-modal">
  <div class="modal-content">
    <span class="close" id="close-qr">Ã—</span>
    <h2>Scan &amp; Pay</h2>

    <!-- PLACEHOLDER for dynamic payment message -->
    <p id="payment-instructions"></p>

    <img id="qr-code" src="https://raw.githubusercontent.com/Arumia10/ALR-Smoothies/refs/heads/main/Pictures/4TPCM%20Mini-Entreprise%20Payconiq.png" alt="QR Code" style="width: 200px; height: auto; margin: 1rem auto; display: block;">

    <!-- âœ… Turnstile goes here inside modal content -->
    <div class="cf-turnstile"
         data-sitekey="0x4AAAAAABd3MtYix_xppNef"
         data-theme="light"
         data-callback="onTurnstileSuccess">
    </div>

    <div style="display:flex; justify-content:space-between; margin-top:1rem;">
      <button id="back-btn" class="btn btn-secondary">Back</button>
      <button id="confirm-pay" class="btn">Confirm Payment</button>
    </div>
  </div>
</div>
   

<!-- CONTACT SECTION -->
<section id="contact" class="contact-section">
  <h2>Contact Us</h2>
  <p>Reach out via Microsoft Teams:</p>
  <p>
    <strong>
      <a href="https://teams.microsoft.com/l/chat/0/0?users=BauNo921@school.lu" target="_blank" style="color: #0071e3; text-decoration: underline;">
        NoÃ©mie Baum
      </a>
    </strong>
  </p>
</section>

<!-- FOOTER -->
<footer class="footer">
  <p>Â© 2025 VitaminBoost ALR. All rights reserved.</p>
</footer>
 
</div>








  
 <!-- Loader script -->
  <script>
      window.addEventListener('load', function () {
        document.getElementById('loader').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';

        // Ensure scroll to top after rendering
        setTimeout(() => window.scrollTo(0, 0), 10);
      });
  </script>


<script type="module">
  import { initializeCartButtons, renderCart } from './cart.js';
  import { setupPickupLogic } from './pickup.js';
  import { initializeOrderLogic } from './order.js';

  initializeCartButtons();
  renderCart();
  setupPickupLogic();
  initializeOrderLogic();
</script>

</body>




  
<script>


  // 6) Confirm & EmailJS
  document.getElementById('confirm-pay').addEventListener('click', () => {
    // Build customer details
    const fn = document.getElementById('fname').value.trim();
    const ln = document.getElementById('lname').value.trim();
    const customerName = `${fn} ${ln}`;
    const customerEmail = document.getElementById('email').value.trim();
    const customerRole = document.getElementById('role').value;
    // Reformat pickup date
    const [Y, M, D] = document.getElementById('pickup-date').value.split('-');
    const pickupDate = `${D}/${M}/${Y}`;
    const token = turnstileToken;

    if (!token) {
      alert("Please complete the human check (Turnstile).");
      return;
    }

    // Build order details string
    const grouped = {};
    cart.forEach(item => {
      if (!grouped[item.name]) grouped[item.name] = { qty: 0, price: item.price };
      grouped[item.name].qty++;
    });
    let orderDetails = '';
    Object.entries(grouped).forEach(([name, info]) => {
      orderDetails += `${info.qty}Ã— ${name}: â‚¬${(info.price * info.qty)
        .toFixed(2)
        .replace('.', ',')}\n`;
    });

// Format the total
const rawTotal = document.getElementById('cart-total').textContent
  .replace('Total: â‚¬', '')
  .replace(',', '.');
const formattedTotal = `${rawTotal}â‚¬`;

    // determine which location to include
    let deliveryLocation = '';
    const wd = new Date(document.getElementById('pickup-date').value).getUTCDay();

    if (wd === 2) {
      // Tuesday delivery at fixed time
      const loc = document.getElementById('location-tue').value.trim();
      deliveryLocation = `14:00â€“14:20 @ ${loc}`;
    } else if (wd === 3) {
  const role = document.getElementById('role').value;

  if (role === 'Student') {
    deliveryLocation = `09:30â€“09:50 @ Virum Festsall`;
  } else {
    const choice = document.querySelector('input[name="wed-option"]:checked')?.value;
    if (choice === 'delivery') {
      const loc = document.getElementById('location-wed-input').value.trim();
      deliveryLocation = `10:00â€“10:20 @ ${loc}`;
    } else {
      deliveryLocation = `09:30â€“09:50 @ Proffen Konferenz`;
    }
  }
}


// 6) Save order to Cloudflare Worker before clearing cart
fetch("https://vitaminboostalr.9fhw2ps22t.workers.dev/", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    name: customerName,
    email: customerEmail,
    role: customerRole,
    pickup_date: pickupDate,
    delivery_location: deliveryLocation,
    order_details: orderDetails,
    total_amount: formattedTotal,
    cf_token: turnstileToken
  })
})
.then(res => res.json())
  .then(data => {
  if (data.success) {
    console.log("âœ… Order saved with ID:", data.order_id);
  } else {
    console.warn("âš ï¸ Failed to save order.");
  }

     // 7a) Send admin email
    emailjs.send('service_j0mv0o1', 'template_1728je9', {
      Name: customerName,
      email: customerEmail,
      order_details: orderDetails,
      total_amount: formattedTotal,
      pickup_date: pickupDate,
      user_role: customerRole,
      delivery_location: deliveryLocation,
      order_id: data.order_id
    })
    .then(r => console.log('Admin email sent', r.status, r.text))
    .catch(e => console.error('Admin email error', e));

    // 7b) Send customer email
    emailjs.send('service_j0mv0o1', 'template_u8nwalz', {
      Name: customerName,
      email: customerEmail,
      order_details: orderDetails,
      total_amount: formattedTotal,
      pickup_date: pickupDate,
      pickup_info: `Delivery window chosen`,
      delivery_location: deliveryLocation,
      order_id: data.order_id
    })
    .then(r => console.log('Customer email sent', r.status, r.text))
    .catch(e => console.error('Customer email error', e));

  // Proceed regardless of success for now
  cart.length = 0;
  renderCart();

  const mc = document.querySelector('#qr-modal .modal-content');
  
  const returnInstructions = customerRole === "Student"
    ? "ğŸ” Return smoothie glasses every Wednesday in front of the Festsall between 09:30â€“09:50."
    : `
    ğŸ” Return glasses anytime in the return box next to the staircase (outside Proffen Konferenz).
    <br><br>
    <img src="https://raw.githubusercontent.com/Arumia10/ALR-Smoothies/refs/heads/main/Pictures/Retour%20Smoothies.jpeg" 
         alt="Return Box Location" 
         style="max-width:100%; border-radius:8px; margin-top:0.5rem;" />
  `;
  
  mc.innerHTML = `
    <h2>Order Confirmed</h2>
    <p>Thank you! Your order has been confirmed.</p>
    <p><strong>Pickup Date:</strong> ${pickupDate}</p>
    <p><strong>Delivery Location:</strong> ${deliveryLocation}</p>
    <p style="margin-top: 1rem;"><strong>â™»ï¸ Please rinse your smoothie glasses before returning them.</strong></p>
    <br>
    <p>${returnInstructions}</p>
    <button id="close-confirm" class="btn">Close</button>
  `;

  document.getElementById('close-confirm').addEventListener('click', () => {
    document.getElementById('qr-modal').style.display = 'none';
    location.reload();
  });
})
.catch(error => {
  console.error("âŒ Error sending order to server:", error);
  alert("There was an error saving your order. Please try again.");
});
  });

  // 8) Dismiss modals on outside click
  window.addEventListener('click', e => {
    if (e.target.classList.contains('modal')) {
      e.target.style.display = 'none';
    }
  });
    
</script>
